<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PPOAlgo Prop Desk</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="title">PPOAlgo - VWAP Momentum Backtester</div>
      <div class="subtitle">Adaptive VWAP breakout strategy with 4-condition entry signal</div>
    </div>
    <div class="actions">
      <button class="primary" id="btn-run-backtest">Run Backtest</button>
      <a href="paper.html" class="paper-trade" id="btn-go-paper"
        style="text-decoration: none; display: inline-flex; align-items: center;">Go Paper</a>
      <button class="ghost" id="btn-toggle-logs">Hide logs</button>
      <button class="secondary" id="btn-export">Export CSV</button>
    </div>
  </header>

  <main class="main-grid">
    <aside class="panel narrow">
      <div class="panel-header">
        <h2>VWAP Config</h2>
        <p class="hint">Adaptive VWAP breakout with slope, stretch, and momentum filters.</p>
      </div>

      <div class="desc-box" id="algo-desc">
        VWAP Momentum: Enters at configured buy time (ET) when price is above VWAP, VWAP slope is positive,
        stretch is within bounds (alpha=0.50), momentum exceeds threshold (gamma=0.25), and price
        is above buy trigger %. Exits at take-profit target, end of day, or holds overnight.
      </div>

      <div class="panel-subheader">Strategy settings</div>
      <div class="form-grid">
        <label>
          Buy trigger % (min % above prev close)
          <input id="buy-trigger" type="number" step="0.1" min="0" value="0.1" />
        </label>
        <label>
          Buy time (ET)
          <input id="buy-time" type="time" value="10:00" />
        </label>
        <label>
          Sell trigger % (take-profit)
          <input id="sell-trigger" type="number" step="0.1" min="0.1" value="5" />
        </label>
        <label>
          Buy amount ($)
          <input id="buy-amount" type="number" step="1000" min="0" value="100000" />
        </label>
        <label class="toggle-row">
          <input type="checkbox" id="compound" checked />
          <span>Compound (reinvest proceeds)</span>
        </label>
        <label class="toggle-row">
          <input type="checkbox" id="sell-eod" checked />
          <span>Sell at market close if target not hit</span>
        </label>
      </div>

      <div class="panel-subheader">Backtest settings</div>
      <div class="form-grid">
        <label>
          Stock ticker
          <input id="stock-symbol" type="text" value="AAPL" />
        </label>
        <label>
          Start date
          <input id="start-date" type="date" />
        </label>
        <label>
          End date
          <input id="end-date" type="date" />
        </label>
        <label>
          Initial capital ($)
          <input id="capital" type="number" value="100000" />
        </label>
      </div>
      <button class="primary" id="btn-run-backtest-side" style="width:100%; margin-top: 12px;">Run Backtest</button>
      <span id="config-status" class="status-pill muted">Ready</span>
    </aside>

    <section class="panel center">
      <div class="panel-header">
        <h2>Charts</h2>
        <p class="hint">Price action with VWAP entries, equity curve, and trade returns.</p>
      </div>
      <div class="chart-card">
        <div class="chart-title">
          <span>Price + VWAP Entries</span>
          <div class="legend">
            <span class="dot buy"></span> Buy
            <span class="dot sell"></span> Sell (TP)
            <span class="dot reduce"></span> Sell (EOD)
          </div>
        </div>
        <div class="chart-container">
          <canvas id="price-chart"></canvas>
        </div>
      </div>

      <div class="chart-grid">
        <div class="chart-card">
          <div class="chart-title"><span>Portfolio Value</span></div>
          <div class="chart-container chart-small">
            <canvas id="portfolio-chart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title"><span>Trade Returns</span></div>
          <div class="chart-container chart-small">
            <canvas id="returns-chart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <aside class="panel narrow">
      <div class="panel-header">
        <h2>Performance</h2>
        <p class="hint">Backtest results and risk metrics.</p>
      </div>
      <div class="metric-section">
        <button class="btn-trade-it" id="btn-trade-it" onclick="addToPaperTrading()">
          Trade It
        </button>
        <div class="metric-grid">
          <div class="metric"><span>Total return</span><strong id="m-return">--</strong></div>
          <div class="metric"><span>Sharpe</span><strong id="m-sharpe">--</strong></div>
          <div class="metric"><span>Sortino</span><strong id="m-sortino">--</strong></div>
          <div class="metric"><span>Max DD</span><strong id="m-dd">--</strong></div>
          <div class="metric"><span>Win rate</span><strong id="m-winrate">--</strong></div>
          <div class="metric"><span>Avg win/loss</span><strong id="m-avg">--</strong></div>
          <div class="metric"><span>Total trades</span><strong id="m-trades">--</strong></div>
          <div class="metric"><span>Final equity</span><strong id="m-equity">--</strong></div>
        </div>
      </div>
      <div class="metric-section">
        <div class="metric-title">VWAP Signal Stats</div>
        <div class="metric-grid">
          <div class="metric"><span>Days analyzed</span><strong id="m-days">--</strong></div>
          <div class="metric"><span>Entries taken</span><strong id="m-entries">--</strong></div>
          <div class="metric"><span>Skipped: below VWAP</span><strong id="m-skip-vwap">--</strong></div>
          <div class="metric"><span>Skipped: slope</span><strong id="m-skip-slope">--</strong></div>
          <div class="metric"><span>Skipped: stretch</span><strong id="m-skip-stretch">--</strong></div>
          <div class="metric"><span>Skipped: momentum</span><strong id="m-skip-momentum">--</strong></div>
          <div class="metric status"><span>Status</span><strong id="m-status">--</strong></div>
        </div>
      </div>
    </aside>
  </main>

  <section class="panel full" id="logs-panel">
    <div class="panel-header">
      <h2>Trade Log</h2>
      <p class="hint">Detailed per-day analysis with VWAP entry conditions and skip reasons.</p>
    </div>
    <div class="log-controls">
      <button class="secondary" id="btn-clear-trades">Clear table</button>
      <button class="secondary" id="btn-clear-logs">Clear activity log</button>
      <label class="toggle">
        <input type="checkbox" id="auto-scroll" checked />
        <span>Auto-scroll</span>
      </label>
    </div>
    <div class="table-wrap">
      <table class="trade-table">
        <thead>
          <tr>
            <th data-sort-key="date">Date</th>
            <th data-sort-key="open">Open</th>
            <th data-sort-key="price_10am">Buy Time $</th>
            <th data-sort-key="vwap">VWAP</th>
            <th data-sort-key="high">High</th>
            <th data-sort-key="close">Close</th>
            <th data-sort-key="action">Action</th>
            <th data-sort-key="skip_reason">Reason</th>
            <th data-sort-key="buy_price">Entry</th>
            <th data-sort-key="sell_price">Exit</th>
            <th data-sort-key="profit">P/L ($)</th>
            <th data-sort-key="equity">Equity</th>
          </tr>
        </thead>
        <tbody id="trade-body"></tbody>
      </table>
    </div>
    <div class="panel-subheader">Activity log</div>
    <div id="log" class="log"></div>
  </section>

  <footer class="footer">
    VWAP algorithm matches optimizer Rust engine (alpha=0.50, gamma=0.25). Data source: Alpaca Markets.
  </footer>

  <script src="app.js"></script>
</body>

</html>
